(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b1c73"],{"20fe":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{attrs:{gutter:24}},[a("Alert",{staticClass:"text-center"},[a("span",{staticStyle:{"font-weight":"blod"}},[t._v("共计："+t._s(t.bak_data_rows)+" 条备份日志")]),t._v("，  "),a("Button",{attrs:{to:"/dashboard/table_bak_record",type:"success"}},[t._v("立即查看")])],1)],1),a("Row",{attrs:{gutter:24}},[a("Col",{staticClass:"hidden-mobile",attrs:{xs:4,lg:4}},[a("Poptip",{attrs:{confirm:"",placement:"right",title:"确认要操作?","ok-text":"确认","cancel-text":"点错了"},on:{"on-ok":function(e){return t.bakUpTableExcute(t.selectIds,!1)}}},[a("Button",{attrs:{type:"success",loading:t.loadingBakBtn}},[t.loadingBakBtn?a("span",[t._v("备份进行中...")]):a("span",[t._v("备份")])])],1)],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:4,lg:2}},[a("Button",{attrs:{type:"info",loading:t.loadingOptimizeBtn},on:{click:function(e){return t.optimizeTableExcute(t.selectIds,!1)}}},[t.loadingOptimizeBtn?a("span",[t._v("优化中...")]):a("span",[t._v("优化")])])],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:4,lg:2}},[a("Button",{attrs:{type:"primary",loading:t.loadingRepairBtn},on:{click:function(e){return t.repairTableExcute(t.selectIds,!1)}}},[t.loadingRepairBtn?a("span",[t._v("修复中...")]):a("span",[t._v("修复")])])],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:6,lg:3}},[a("Input",{attrs:{icon:"search",placeholder:"请输入表名搜索..."},model:{value:t.searchForm.table_name,callback:function(e){t.$set(t.searchForm,"table_name",e)},expression:"searchForm.table_name"}})],1),a("Col",{attrs:{xs:3,lg:3}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:function(e){return t.getTableDataExcute(t.feeds.current_page)}}},[t._v(t._s(t.$t("search")))])],1)],1),a("br"),a("Row",[t.tableLoading?a("div",{staticClass:"demo-spin-container"},[a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"load-c",size:"18"}}),a("div",[t._v(t._s(t.$t("table_loading")))])],1)],1):t._e(),a("Table",{attrs:{height:"600",size:"small",columns:t.columns,data:t.feeds.data},on:{"on-sort-change":t.onSortChange,"on-selection-change":t.onSelectionChange},scopedSlots:t._u([{key:"action",fn:function(t){t.row,t.index}}])}),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[t._v("\n        "+t._s(t.all_tables_num)+" 张表，"+t._s(t.all_tables_length)+"\n      ")])])],1)],1)},i=[],s=a("66df"),o=function(t,e,a){return s["a"].request({url:"/api/admin/databases",params:{page:t,per_page:e,search_data:JSON.stringify(a)},method:"get"})},l=function(t,e){return s["a"].request({url:"/api/admin/databases/bak_table",data:{is_op_all:e,selectes:t},method:"post"})},r=function(t,e){return s["a"].request({url:"/api/admin/databases/optimize_table",data:{is_op_all:e,selectes:t},method:"post"})},c=function(t,e){return s["a"].request({url:"/api/admin/databases/repair_table",data:{is_op_all:e,selectes:t},method:"post"})},d=a("90de"),u={data:function(){return{searchForm:{order_by:"created_at,desc",table_name:"",column:""},notRealySortKey:[],tableLoading:!1,feeds:{data:[],total:0,current_page:1,per_page:10},all_tables_num:0,all_tables_length:0,selectIds:"",loadingBakBtn:!1,loadingOptimizeBtn:!1,loadingRepairBtn:!1,bak_data_rows:0,columns:[{type:"selection",width:60,align:"center"},{title:"表名",key:"Name",minWidth:100},{title:"存储引擎",key:"Engine",minWidth:60},{title:"行数",key:"Rows",minWidth:60,sortable:!0},{title:"数据",key:"Data_length",minWidth:60,sortable:!0},{title:"索引",key:"Index_length",minWidth:60,sortable:!0},{title:"全部",key:"Total_length",minWidth:60,sortable:!0},{title:"创建时间",key:"Create_time",sortable:!0,minWidth:150},{title:"修改时间",key:"Update_time",sortable:!0,minWidth:150}]}},created:function(){var t=this;t.getTableDataExcute(t.feeds.current_page)},methods:{getTableDataExcute:function(t){var e=this;e.tableLoading=!0,e.feeds.current_page=t,o(t,e.feeds.per_page,e.searchForm).then(function(t){e.feeds.data=t.data.data,e.all_tables_num=t.data.all_tables_num,e.all_tables_length=t.data.all_tables_length,e.bak_data_rows=t.data.bak_data_rows,e.feeds.total=0,e.tableLoading=!1},function(t){e.tableLoading=!1})},onSortChange:function(t){var e=t.column.key+","+t.order;Object(d["i"])(t.column.key,this.notRealySortKey)||(this.searchForm.order_by=e)},tableButtonEdit:function(t,e){this.editModal.show=!0,this.editModal.id=t.id},tableButtonDestroyOk:function(t,e){var a=this;destroy(t.id).then(function(t){a.feeds.data.splice(e,1),a.$Notice.success({title:t.message})})},tableButtonShowInfo:function(t,e){this.showInfoModal.show=!0,this.showInfoModal.info=t},onSelectionChange:function(t){for(var e in this.selectIds="",t)this.selectIds+=","+t[e].Name},bakUpTableExcute:function(t,e){var a=this;if(!1===e&&!t)return this.$Notice.error({title:"出错了",desc:"请先选择要操作的项"}),!1;this.loadingBakBtn=!0;l(t,e).then(function(t){a.$Notice.success({title:"操作成功",desc:t.message,duration:0}),a.loadingBakBtn=!1}).catch(function(t){a.loadingBakBtn=!1})},optimizeTableExcute:function(t,e){var a=this;if(!1===e&&!t)return this.$Notice.error({title:"出错了",desc:"请先选择要操作的项"}),!1;this.loadingOptimizeBtn=!0;r(t,e).then(function(t){a.$Notice.success({title:"操作成功",desc:t.message,duration:0}),a.loadingOptimizeBtn=!1}).catch(function(t){a.loadingOptimizeBtn=!1})},repairTableExcute:function(t,e){var a=this;if(!1===e&&!t)return this.$Notice.error({title:"出错了",desc:"请先选择要操作的项"}),!1;this.loadingRepairBtn=!0;c(t,e).then(function(t){a.$Notice.success({title:"操作成功",desc:t.message}),a.loadingRepairBtn=!1}).catch(function(t){a.loadingRepairBtn=!1})}}},h=u,p=a("6691"),_=Object(p["a"])(h,n,i,!1,null,null,null);e["default"]=_.exports}}]);