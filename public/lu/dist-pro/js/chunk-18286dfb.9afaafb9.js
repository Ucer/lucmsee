(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18286dfb"],{2934:function(e,t,a){"use strict";a.d(t,"b",function(){return o}),a.d(t,"d",function(){return n}),a.d(t,"c",function(){return r}),a.d(t,"e",function(){return l}),a.d(t,"a",function(){return i});var s=a("66df"),o=function(e){return s["a"].request({url:"api/get_captcha",method:"get"})},n=function(e){return s["a"].request({url:"/api/common_get_table_status/"+e,method:"get"})},r=function(e){return s["a"].request({url:"/api/common_get_config_file_data",data:{config_item:e},method:"post"})},l=function(e,t,a){return s["a"].request({url:"/api/common_switch_enable",data:{id:e,table:t,value:a},method:"post"})},i=function(e,t,a,o){return s["a"].request({url:"/api/common_edit_talbe_column",data:{id:e,table:t,column:a,value:o},method:"post"})}},"2e66":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",{attrs:{gutter:24}},[a("Col",{attrs:{xs:6,lg:2}},[a("Button",{attrs:{type:"success",icon:"plus"},on:{click:function(t){return e.addBtn()}}},[e._v("发消息")])],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:0,lg:2}},[a("Poptip",{attrs:{confirm:"",placement:"bottom",title:"确认要删除选中的数据?","ok-text":"确认","cancel-text":"点错了"},on:{"on-ok":function(t){return e.batchDestroyExcute(e.selectIds)}}},[a("Button",{attrs:{type:"error",loading:e.loadingBatchDestroy}},[e.loadingBatchDestroy?a("span",[e._v("删除中...")]):a("span",[e._v("删除")])])],1)],1),a("Col",{attrs:{xs:1,lg:3}},[a("Select",{attrs:{placeholder:"消息类型"},model:{value:e.searchForm.message_type,callback:function(t){e.$set(e.searchForm,"message_type",t)},expression:"searchForm.message_type"}},[a("Option",{key:"",attrs:{value:""}},[e._v("全部")]),e._l(e.tableStatus.message_type,function(t,s){return a("Option",{key:s,attrs:{value:s}},[e._v(e._s(t))])})],2)],1),a("Col",{attrs:{xs:1,lg:3}},[a("Select",{attrs:{placeholder:"状态"},model:{value:e.searchForm.is_read,callback:function(t){e.$set(e.searchForm,"is_read",t)},expression:"searchForm.is_read"}},[a("Option",{key:"",attrs:{value:""}},[e._v("全部")]),e._l(e.tableStatus.is_read,function(t,s){return a("Option",{key:s,attrs:{value:s}},[e._v(e._s(t))])})],2)],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:0,lg:3}},[a("Input",{attrs:{icon:"search",placeholder:"请输入发送人手机号搜索..."},model:{value:e.searchForm.send_user_mobile,callback:function(t){e.$set(e.searchForm,"send_user_mobile",t)},expression:"searchForm.send_user_mobile"}})],1),a("Col",{attrs:{xs:3,lg:3}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:function(t){return e.getTableDataExcute(e.feeds.current_page)}}},[e._v(e._s(e.$t("search")))])],1)],1),a("br"),a("Row",[e.tableLoading?a("div",{staticClass:"demo-spin-container"},[a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"load-c",size:"18"}}),a("div",[e._v(e._s(e.$t("table_loading")))])],1)],1):e._e(),a("Table",{attrs:{border:"",columns:e.columns,data:e.feeds.data},on:{"on-sort-change":e.onSortChange,"on-selection-change":e.onSelectionChange},scopedSlots:e._u([{key:"send_user",fn:function(t){var a=t.row;t.index;return[e._v("\n        "+e._s(a.admin_user.real_name)+"\n      ")]}},{key:"recive_user",fn:function(t){var a=t.row;t.index;return[e._v("\n        "+e._s(a.user.real_name)+"\n      ")]}},{key:"message_type",fn:function(t){var a=t.row;t.index;return[e._v("\n        "+e._s(e.tableStatus.message_type[a.message_type])+"\n      ")]}},{key:"is_read",fn:function(t){var a=t.row;t.index;return[e._v("\n        "+e._s(e.tableStatus.is_read[a.is_read])+"\n      ")]}},{key:"action",fn:function(t){var s=t.row,o=t.index;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.tableButtonShowInfo(s,o)}}},[e._v(e._s(e.$t("show_info")))]),a("Poptip",{attrs:{confirm:"",title:"您确定要删除ID为："+s.id+" 的记录？"},on:{"on-ok":function(t){return e.tableButtonDestroyOk(s,o)}}},[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small"}},[e._v(e._s(e.$t("destroy")))])],1)]}}])}),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{staticClass:"paging",attrs:{total:e.feeds.total,current:e.feeds.current_page,"page-size":e.feeds.per_page,"show-elevator":"","show-total":"","show-sizer":""},on:{"on-change":e.handleOnPageChange,"on-page-size-change":e.onPageSizeChange}})],1)])],1),e.addModal.show?a("add-component",{attrs:{tableStatus_is_alert_at_home:e.tableStatus.is_alert_at_home,tableStatus_message_type:e.tableStatus.message_type},on:{"on-add-modal-success":function(t){return e.getTableDataExcute(e.feeds.current_page)},"on-add-modal-hide":e.addModalHide}}):e._e(),e.showInfoModal.show?a("show-info",{attrs:{info:e.showInfoModal.info},on:{"show-modal-close":e.showModalClose}}):e._e()],1)},o=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{closable:!1,"mask-closable":!1,width:"600"},model:{value:e.modalShow,callback:function(t){e.modalShow=t},expression:"modalShow"}},[a("p",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(e.$t("add")))]),a("Form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,"label-position":"left","label-width":100}},[a("FormItem",{attrs:{label:"标题：",prop:"title"}},[a("Input",{attrs:{placeholder:"请输消息标题"},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}})],1),a("FormItem",{attrs:{label:"消息内容：",prop:"content"}},[a("Input",{attrs:{type:"textarea",placeholder:"请输入消息内容"},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1),a("FormItem",{attrs:{label:"消息类型："}},[a("Select",{attrs:{filterable:"",placeholder:"请选择消息类型"},model:{value:e.formData.message_type,callback:function(t){e.$set(e.formData,"message_type",t)},expression:"formData.message_type"}},e._l(e.tableStatus_message_type,function(t,s){return a("Option",{key:s,attrs:{value:s}},[e._v(e._s(t)+" ")])}),1)],1),a("FormItem",{attrs:{label:"是否在首页提示："}},[a("RadioGroup",{model:{value:e.formData.is_alert_at_home,callback:function(t){e.$set(e.formData,"is_alert_at_home",t)},expression:"formData.is_alert_at_home"}},e._l(e.tableStatus_is_alert_at_home,function(t,s){return a("Radio",{key:s,attrs:{label:s}},[e._v(e._s(t))])}),1)],1),a("FormItem",{attrs:{label:"消息接收人："}},[a("Select",{attrs:{multiple:"",filterable:"",remote:"","remote-method":e.searchUserPassMobileExcute,loading:e.searchLoading,placeholder:"请输入手机号搜索"},model:{value:e.formData.users,callback:function(t){e.$set(e.formData,"users",t)},expression:"formData.users"}},e._l(e.userList,function(t,s){return a("Option",{key:s,attrs:{value:t.id}},[e._v(e._s(t.real_name)+"("+e._s(t.mobile)+")")])}),1),a("input-helper",{attrs:{text:"不选将发送给所有人","style-class":"input-helper-error"}})],1),a("FormItem",{attrs:{label:"跳转 url："}},[a("Input",{attrs:{placeholder:"跳转 url"},model:{value:e.formData.url,callback:function(t){e.$set(e.formData,"url",t)},expression:"formData.url"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),a("Button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.sendMessageToAppUserExcute}},[e._v(e._s(e.$t("save"))+" ")])],1)],1)],1)},r=[],l=a("66df"),i=function(e,t,a){return l["a"].request({url:"/api/admin/app_messages",params:{page:e,per_page:t,search_data:JSON.stringify(a)},method:"get"})},c=function(e){return l["a"].request({url:"/api/admin/app_messages/send_message_to_app_user",data:e,method:"post"})},u=function(e){return l["a"].request({url:"/api/admin/app_messages/"+e,method:"delete"})},d=function(e){return l["a"].request({url:"/api/admin/app_messages/"+e+"/batch",method:"delete"})},m=a("c24f"),_=a("9f69"),f={props:["tableStatus_message_type","tableStatus_is_alert_at_home"],components:{InputHelper:_["a"]},data:function(){return{modalShow:!0,saveLoading:!1,searchLoading:!1,userList:[],formData:{title:"",message_type:"",url:"",users:"",content:"",is_alert_at_home:"F"},rules:{title:[{required:!0,message:"请填写消息标题",trigger:"blur"}],content:[{required:!0,message:"请填写消息内容",trigger:"blur"}],type:[{required:!0,message:"请选择消息类型",trigger:"blur"}]}}},methods:{searchUserPassMobileExcute:function(e){var t=this,a=this;if(e.length<3)return!1;a.searchLoading=!0,Object(m["m"])(e).then(function(e){t.userList=e.data,a.searchLoading=!1})},sendMessageToAppUserExcute:function(){var e=this;e.$refs.formData.validate(function(t){t&&(e.saveLoading=!0,c(e.formData).then(function(t){e.saveLoading=!1,e.modalShow=!1,e.$emit("on-add-modal-success"),e.$emit("on-add-modal-hide"),e.$Notice.success({title:t.message})}))})},cancel:function(){this.modalShow=!1,this.$emit("on-add-modal-hide")}}},p=f,h=a("6691"),g=Object(h["a"])(p,n,r,!1,null,null,null),b=g.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Drawer",{attrs:{closable:!0,title:"消息详情",width:e.platformIsPc?30:80},on:{"on-close":e.closed},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("div",{staticClass:"drawer-profile"},[a("Row",[a("li",[a("span",{staticClass:"blod-font"},[e._v("消息标题：")]),e._v(" "+e._s(e.info.title)+" ")]),e.info.admin_user?a("li",[a("span",{staticClass:"blod-font"},[e._v("发送人：")]),e._v(e._s(e.info.admin_user.real_name)+" ("+e._s(e.info.admin_user.mobile)+") ")]):e._e(),e.info.user?a("li",[a("span",{staticClass:"blod-font"},[e._v(" 接收人：")]),e._v(e._s(e.info.user.real_name)+" ("+e._s(e.info.user.mobile)+") ")]):e._e()]),a("h2",{staticClass:"text-center margin-top-8"},[e._v("消息内容")]),a("div",{staticClass:"text-center",domProps:{innerHTML:e._s(e.info.content)}})],1)])],1)},y=[],w={props:{info:{type:Object,default:""}},data:function(){return{show:!0,agreement:""}},computed:{platformIsPc:function(){return"pc"===this.globalPlatformType()}},methods:{closed:function(){this.show=!1,this.$emit("show-modal-close")}}},x=w,S=Object(h["a"])(x,v,y,!1,null,null,null),k=S.exports,D=a("2934"),C=a("90de"),I={components:{AddComponent:b,ShowInfo:k},data:function(){return{searchForm:{order_by:"created_at,desc",message_type:"",is_read:"",is_alert_at_home:"",send_user_mobile:""},notRealySortKey:[],tableLoading:!1,loadingBatchDestroy:!1,selectIds:"",tableStatus:{message_type:[],is_read:[],is_alert_at_home:[]},feeds:{data:[],total:0,current_page:1,per_page:10},addModal:{show:!1},showInfoModal:{show:!1,info:""},columns:[{type:"selection",width:60,align:"center"},{title:"ID",key:"id",sortable:"customer",minWidth:100},{title:"标题",key:"title",minWidth:100},{title:"发送人",key:"send_user",minWidth:80,slot:"send_user"},{title:"接收人",key:"recive_user",minWidth:80,slot:"recive_user"},{title:"消息类型",minWidth:100,slot:"message_type"},{title:"是否已读",minWidth:40,slot:"is_read"},{title:"内容",key:"content",tooltip:!0,minWidth:100},{title:"创建时间",key:"created_at",minWidth:150},{title:"更新录时间",key:"updated_at",sortable:"customer",minWidth:150},{title:"操作",key:"",minWidth:200,slot:"action"}]}},created:function(){var e=this;e.getTableStatusExcute("app_messages")},methods:{handleOnPageChange:function(e){this.getTableDataExcute(e)},onPageSizeChange:function(e){this.feeds.per_page=e,this.getTableDataExcute(this.feeds.current_page)},getTableStatusExcute:function(e){var t=this;Object(D["d"])(e).then(function(e){t.tableStatus.message_type=e.data.message_type,t.tableStatus.is_read=e.data.is_read,t.tableStatus.is_alert_at_home=e.data.is_alert_at_home,t.getTableDataExcute(t.feeds.current_page)})},getTableDataExcute:function(e){var t=this;t.tableLoading=!0,t.feeds.current_page=e,i(e,t.feeds.per_page,t.searchForm).then(function(e){t.feeds.data=e.data,t.feeds.total=e.meta.total,t.tableLoading=!1},function(e){t.tableLoading=!1})},onSortChange:function(e){var t=e.column.key+","+e.order;Object(C["i"])(e.column.key,this.notRealySortKey)||(this.searchForm.order_by=t,this.getTableDataExcute(this.feeds.current_page))},onSelectionChange:function(e){for(var t in this.selectIds="",e)this.selectIds+=","+e[t].id},tableButtonDestroyOk:function(e,t){var a=this;u(e.id).then(function(e){a.feeds.data.splice(t,1),a.$Notice.success({title:e.message})})},addBtn:function(){this.addModal.show=!0},addModalHide:function(){this.addModal.show=!1},batchDestroyExcute:function(e){if(!e)return this.$Notice.error({title:"出错了",desc:"请先选择要操作的项"}),!1;var t=this;t.loadingBatchDestroy=!0,d(e).then(function(e){t.getTableDataExcute(t.feeds.current_page),t.loadingBatchDestroy=!1})},tableButtonShowInfo:function(e,t){this.showInfoModal.show=!0,this.showInfoModal.info=e},showModalClose:function(){this.showInfoModal.show=!1}}},$=I,E=Object(h["a"])($,s,o,!1,null,null,null);t["default"]=E.exports},"9f69":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("Icon",{attrs:{type:e.type}}),a("span",{class:e.styleClass},[e._v(e._s(e.text))])],1)},o=[],n={props:{styleClass:{type:String,default:"color-light-gray"},type:{type:String,default:"md-information"},text:{type:String,default:"温馨提示..."}}},r=n,l=a("6691"),i=Object(l["a"])(r,s,o,!1,null,null,null);t["a"]=i.exports}}]);